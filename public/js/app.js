function initMap(){var e=[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}],o={lat:34.0702802,lng:-118.1246111};map=new google.maps.Map(document.getElementById("map"),{center:o,zoom:13,styles:e,mapTypeControl:!1});for(var t=new google.maps.InfoWindow,a=0;a<viewModel.filteredLocations().length;a++){var i=viewModel.filteredLocations()[a].id,r=viewModel.filteredLocations()[a].bizId,n=viewModel.filteredLocations()[a].location,l=viewModel.filteredLocations()[a].title,s=viewModel.filteredLocations()[a].type,c=makeMarkerIcon("Before",s),d=makeMarkerIcon("After",s),g=new google.maps.Marker({map:map,type:s,position:n,title:l,animation:google.maps.Animation.DROP,icon:c,highlightedIcon:d,defaultIcon:c,id:i,bizId:r});viewModel.filteredLocations()[a].marker=g,markers.push(g),g.addListener("click",function(){var e=this;e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1400),populateInfoWindow(this,t)}),g.addListener("mouseover",function(){this.setIcon(this.highlightedIcon)}),g.addListener("mouseout",function(){this.setIcon(this.defaultIcon)})}}function makeMarkerIcon(e,o){var t=new google.maps.MarkerImage("img/"+o+"_"+e+".svg",new google.maps.Size(64,64),new google.maps.Point(0,0),new google.maps.Point(32,64),new google.maps.Size(64,64));return t}function populateInfoWindow(e,o){var t=new google.maps.places.PlacesService(map);t.getDetails({placeId:e.id},function(t,a){function i(){return Math.floor(1e12*Math.random()).toString()}if(console.log(t),console.log(a),console.log(e.bizId),o.marker!=e,a==google.maps.StreetViewStatus.OK){o.marker=e;var r='<div class="infowindow">',n="https://api.yelp.com/v2/business/"+e.bizId,l={oauth_consumer_key:"hXgPJ8oeGx5cLCp54G-7RQ",oauth_token:"zTWQp_ENU6OZwUm4GaDGNi70wTPGtUpj",oauth_nonce:i(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},s=oauthSignature.generate("GET",n,l,"m3n1T9WThmp53i7I4M-jW6pqDvA","QWBZJjSM14BwaW-CHmHQjcNHBNk");l.oauth_signature=s;var c={url:n,data:l,cache:!0,dataType:"jsonp",success:function(t){if(t.rating_img_url){o.marker=e;var a;a=t.rating_img_url?t.rating_img_url:"No Rating Image Available",o.setContent('<div class="yelp"><img src="'+t.rating_img_url+'"></div>'+r),o.open(map,e),o.addListener("closeclick",function(){o.marker=null})}},error:function(){console.log("Yelp API can not work properly!"),viewModel.apiErrorMessage(!0)}};$.ajax(c),r+="<strong>"+e.title+"</strong>",r+="<br>"+t.formatted_address,t.formatted_phone_number&&(r+="<br>"+t.formatted_phone_number),t.photos&&(r+='<br><br><img src="'+t.photos[0].getUrl({maxHeight:100,maxWidth:200})+'">'),r+="</div>"}})}function googleError(){viewModel.mapErrorMessage(!0)}function mapError(){alert("Script Error: See Browser Console for Detail")}var locations=[{title:"Mark Keppel High School",location:{lat:34.070465,lng:-118.115601},type:["School"],id:"ChIJtwkJXk3FwoARLa3bhWCYeic",bizId:"mark-keppel-high-school-alhambra"},{title:"Half & Half Tea House",location:{lat:34.063846,lng:-118.134599},type:["Drink"],id:"ChIJo-q-Tl3FwoARFvIg1LL0xc0",bizId:"half-and-half-tea-express-monterey-park-monterey-park"},{title:"Boba Ave 8090",location:{lat:34.078642,lng:-118.101897},type:["Drink"],id:"ChIJ42uSTbfawoARo8LycmjL7DE",bizId:"boba-ave-8090-san-gabriel-2"},{title:"Tea Station",location:{lat:34.09214,lng:-118.132422},type:["Drink"],id:"ChIJzdhPCSHFwoAR2SK71bT3CnU",bizId:"tea-station-alhambra"},{title:"Tea Brick",location:{lat:34.0627834,lng:-118.129498},type:["Drink"],id:"ChIJFZxagVvFwoAR07lvkYmDlSU",bizId:"tea-brick-monterey-park"},{title:"Factory Tea Bar",location:{lat:34.097658,lng:-118.109007},type:["Drink"],id:"ChIJ5zgvXtTawoARdjtqffb8osE",bizId:"factory-tea-bar-san-gabriel"},{title:"Le Arbre Tea House",location:{lat:34.080447,lng:-118.083796},type:["Drink"],id:"ChIJhTc3LpfawoARgSSEUaFwlEc",bizId:"le-arbre-tea-house-rosemead-2"},{title:"Honeyboba",location:{lat:34.0495,lng:-118.082349},type:["Drink"],id:"ChIJM8dremnQwoARtzJ8GQTLG_Q",bizId:"honeyboba-los-angeles"}],Location=function(e){var o=this;o.title=e.title,o.location=e.location,o.type=e.type,o.id=e.id,o.bizId=e.bizId,o.show=ko.observable(!0)},ViewModel=function(){var e=this;e.locs=ko.observableArray(locations),e.query=ko.observable(""),e.filteredLocations=ko.observableArray(),e.mapErrorMessage=ko.observable(!1),e.apiErrorMessage=ko.observable(!1);for(var o=0;o<locations.length;o++){var t=new Location(locations[o]);e.filteredLocations.push(t)}e.filterFunctions=ko.computed(function(){for(var o=e.query(),t=0;t<e.filteredLocations().length;t++)e.filteredLocations()[t].title.toLowerCase().indexOf(o)>=0?(e.filteredLocations()[t].show(!0),e.filteredLocations()[t].marker&&e.filteredLocations()[t].marker.setVisible(!0)):(e.filteredLocations()[t].show(!1),e.filteredLocations()[t].marker&&e.filteredLocations()[t].marker.setVisible(!1))}),e.showInfo=function(e){google.maps.event.trigger(e.marker,"click")}},map,markers=[],viewModel=new ViewModel;ko.applyBindings(viewModel);